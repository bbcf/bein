<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>bein.program</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="bein-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://bbcf.epfl.ch/bein">bein</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="bein-module.html">Package&nbsp;bein</a> ::
        Class&nbsp;program
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="bein.program-class.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== CLASS DESCRIPTION ==================== -->
<h1 class="epydoc">Class program</h1><p class="nomargin-top"></p>
<center>
<center>  <map id="uml_class_diagram_for_bein_pro_3" name="uml_class_diagram_for_bein_pro_3">
<area shape="rect" id="node6" href="bein.program-class.html#__call__" title="Run a program locally, and block until it completes." alt="" coords="17,39,252,57"/>
<area shape="rect" id="node6" href="bein.program-class.html#__init__" title="x.__init__(...) initializes x; see x.__class__.__doc__ for signature" alt="" coords="17,57,252,76"/>
<area shape="rect" id="node6" href="bein.program-class.html#lsf" title="Deprecated." alt="" coords="17,76,252,95"/>
<area shape="rect" id="node6" href="bein.program-class.html#nonblocking" title="Run a program, but return a Future object instead of blocking." alt="" coords="17,95,252,113"/>
<area shape="rect" id="node1" href="bein.program-class.html" title="Decorator to wrap external programs for use by bein." alt="" coords="5,6,264,119"/>
</map>
  <img src="uml_class_diagram_for_bein_pro_3.gif" alt='' usemap="#uml_class_diagram_for_bein_pro_3" ismap="ismap" class="graph-without-title" />
</center>
</center>
<hr />
<p>Decorator to wrap external programs for use by bein.</p>
  <p>Bein depends on external programs to do most of its work.  In this 
  sense, it's a strange version of a shell.  The ``@program`` decorator 
  makes bindings to external programs only a couple lines long.</p>
  <p>To wrap a program, write a function that takes whatever arguments you 
  will need to vary in calling the program (for instance, the filename for 
  touch or the number of seconds to sleep for sleep). This function should 
  return a dictionary containing two keys, ``'arguments'`` and 
  ``'return_value'``.  ``'arguments'`` should point to a list of strings 
  which is the actual command and arguments to be executed 
  (``[&quot;touch&quot;,filename]`` for touch, for instance). 
  ``'return_value'`` should point to a value to return, or a callable 
  object which takes a ProgramOutput object and returns the value that will
  be passed back to the user when this program is run.</p>
  <p>For example, to wrap touch, we write a one argument function that 
  takes the filename of the file to touch, and apply the ``@program`` 
  decorator to it:</p>
<pre class="literalblock">
   @program
   def touch(filename):
       return {&quot;arguments&quot;: [&quot;touch&quot;,filename],
               &quot;return_value&quot;: filename}
</pre>
  <p>Once we have such a function, how do we call it?  We can call it 
  directly, but ``@program`` inserts an additional argument at the 
  beginning of the argument list to take the execution the program is run 
  in.  Typically it will be run like:</p>
<pre class="literalblock">
   with execution(lims) as ex:
       touch(ex, &quot;myfile&quot;)
</pre>
  <p>where ``lims`` is a MiniLIMs object.  The ProgramOutput of touch is 
  automatically recorded to the execution ``ex`` and stored in the 
  MiniLIMS.  The value returned by touch is ``&quot;myfile&quot;``, the 
  name of the touched file.</p>
  <p>Often you want to call a function, but not block when it returns so 
  you can run several in parallel.  ``@program`` also creates a method 
  ``nonblocking`` which does this.  The return value is a Future object 
  with a single method: ``wait()``.  When you call ``wait()``, it blocks 
  until the program finishes, then returns the same value that you would 
  get from calling the function directly. So to touch two files, and not 
  block until both commands have started, you would write:</p>
<pre class="literalblock">
   with execution(lims) as ex:
       a = touch.nonblocking(ex, &quot;myfile1&quot;)
       b = touch.nonblocking(ex, &quot;myfile2&quot;)
       a.wait()
       b.wait()
</pre>
  <p>By default, ``nonblocking`` runs local processes, but you can control 
  how it runs its processes with the ``via`` keyword argument.  For 
  example, on systems using the LSF batch submission system,s you can run 
  commands via batch submission by passing the ``via`` argument the value 
  ``&quot;lsf&quot;``:</p>
<pre class="literalblock">
   with execution(lims) as ex:
       a = touch.nonblocking(ex, &quot;myfile1&quot;, via=&quot;lsf&quot;)
       a.wait()
</pre>
  <p>You can force local execution with ``via=&quot;local&quot;``.</p>
  <p>Some programs do not accept an output file as an argument and only 
  write to ``stdout``.  Alternately, you might need to capture ``stderr`` 
  to a file.  All the methods of ``@program`` accept keyword arguments 
  ``stdout`` and ``stderr`` to specify files to write these streams to.  If
  they are omitted, then both streams are captured and returned in the 
  ``ProgramOutput`` object.</p>

<!-- ==================== INSTANCE METHODS ==================== -->
<a name="section-InstanceMethods"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Instance Methods</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-InstanceMethods"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="bein.program-class.html#__call__" class="summary-sig-name">__call__</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">ex</span>,
        <span class="summary-sig-arg">*args</span>,
        <span class="summary-sig-arg">**kwargs</span>)</span><br />
      Run a program locally, and block until it completes.</td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="bein.program-class.html#__init__" class="summary-sig-name">__init__</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">gen_args</span>)</span><br />
      x.__init__(...) initializes x; see x.__class__.__doc__ for signature</td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="bein.program-class.html#_local" class="summary-sig-name" onclick="show_private();">_local</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">ex</span>,
        <span class="summary-sig-arg">*args</span>,
        <span class="summary-sig-arg">**kwargs</span>)</span><br />
      Method called by ``nonblocking`` for running locally.</td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="_lsf"></a><span class="summary-sig-name">_lsf</span>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">ex</span>,
        <span class="summary-sig-arg">*args</span>,
        <span class="summary-sig-arg">**kwargs</span>)</span><br />
      Method called by ``nonblocking`` to run via LSF.</td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="bein.program-class.html#lsf" class="summary-sig-name">lsf</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">ex</span>,
        <span class="summary-sig-arg">*args</span>,
        <span class="summary-sig-arg">**kwargs</span>)</span><br />
      Deprecated.</td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="bein.program-class.html#nonblocking" class="summary-sig-name">nonblocking</a>(<span class="summary-sig-arg">self</span>,
        <span class="summary-sig-arg">ex</span>,
        <span class="summary-sig-arg">*args</span>,
        <span class="summary-sig-arg">**kwargs</span>)</span><br />
      Run a program, but return a Future object instead of blocking.</td>
          <td align="right" valign="top">
            
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
  <tr>
    <td colspan="2" class="summary">
    <p class="indent-wrapped-lines"><b>Inherited from <code>object</code></b>:
      <code>__delattr__</code>,
      <code>__format__</code>,
      <code>__getattribute__</code>,
      <code>__hash__</code>,
      <code>__new__</code>,
      <code>__reduce__</code>,
      <code>__reduce_ex__</code>,
      <code>__repr__</code>,
      <code>__setattr__</code>,
      <code>__sizeof__</code>,
      <code>__str__</code>,
      <code>__subclasshook__</code>
      </p>
    </td>
  </tr>
</table>
<!-- ==================== PROPERTIES ==================== -->
<a name="section-Properties"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Properties</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Properties"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
  <tr>
    <td colspan="2" class="summary">
    <p class="indent-wrapped-lines"><b>Inherited from <code>object</code></b>:
      <code>__class__</code>
      </p>
    </td>
  </tr>
</table>
<!-- ==================== METHOD DETAILS ==================== -->
<a name="section-MethodDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Method Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-MethodDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="__call__"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">__call__</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">ex</span>,
        <span class="sig-arg">*args</span>,
        <span class="sig-arg">**kwargs</span>)</span>
    <br /><em class="fname">(Call operator)</em>
  </h3>
  </td><td align="right" valign="top"
    >&nbsp;
    </td>
  </tr></table>
  
  <p>Run a program locally, and block until it completes.</p>
  <p>This form takes one argument before those to the decorated function, 
  an execution the program should be run as part of. The return_code, pid, 
  stdout, stderr, and command arguments of the program are recorded to that
  execution, and thus to the MiniLIMS object.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="__init__"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">__init__</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">gen_args</span>)</span>
    <br /><em class="fname">(Constructor)</em>
  </h3>
  </td><td align="right" valign="top"
    >&nbsp;
    </td>
  </tr></table>
  
  <p>x.__init__(...) initializes x; see x.__class__.__doc__ for 
  signature</p>
  <dl class="fields">
    <dt>Overrides:
        object.__init__
        <dd><em class="note">(inherited documentation)</em></dd>
    </dt>
  </dl>
</td></tr></table>
</div>
<a name="_local"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_local</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">ex</span>,
        <span class="sig-arg">*args</span>,
        <span class="sig-arg">**kwargs</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    >&nbsp;
    </td>
  </tr></table>
  
  <p>Method called by ``nonblocking`` for running locally.</p>
  <p>If you need to pass a ``via`` keyword argument to your function, you 
  will have to call this method directly.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="lsf"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">lsf</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">ex</span>,
        <span class="sig-arg">*args</span>,
        <span class="sig-arg">**kwargs</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    >&nbsp;
    </td>
  </tr></table>
  
  <p>Deprecated.  Use nonblocking(via=&quot;lsf&quot;) instead.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<a name="nonblocking"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">nonblocking</span>(<span class="sig-arg">self</span>,
        <span class="sig-arg">ex</span>,
        <span class="sig-arg">*args</span>,
        <span class="sig-arg">**kwargs</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    >&nbsp;
    </td>
  </tr></table>
  
  <pre class="literalblock">
Run a program, but return a Future object instead of blocking.

Like __call__, nonblocking takes an Execution as an extra,
initial argument before the arguments to the decorated
function.  However, instead of blocking, it starts the program
in a separate thread, and returns an object which lets the
user choose when to wait for the program by calling its wait()
method.  When wait() is called, the thread blocks, and the
program is recorded in the execution and its value returned as
if the use had called __call__ directory.  Thus,

with execution(lims) as ex:
    f = touch(&quot;boris&quot;)

is exactly equivalent to

with execution(lims) as ex:
    a = touch.nonblocking(&quot;boris&quot;)
    f = a.wait()

All the methods are named as _method, with the same arguments
as ``nonblocking``.  That is, the ``via=&quot;local&quot;`` method is
implemented by ``_local``, the ``via=&quot;lsf&quot;`` method by
``_lsf``, etc.  When writing a new method, name it in the same
way, and add a condition to the ``if`` statement in
``nonblocking``.

If you need to pass a keyword argument ``via`` to your
program, you will need to call one of the hidden methods
(``_local`` or ``_lsf``) directly.

</pre>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="bein-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="http://bbcf.epfl.ch/bein">bein</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Wed Aug 31 20:08:11 2011
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
